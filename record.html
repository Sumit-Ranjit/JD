<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JSON Data Editor</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 20px;
    }
    table, th, td {
      border: 1px solid black;
    }
    th, td {
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
    input, select, textarea {
      width: 100%;
      padding: 5px;
      box-sizing: border-box;
    }
  </style>
</head>
<body>
  <h1>Data Entry</h1>

  <form id="data-form">
    <table>
      <thead>
        <tr>
          <th>Area</th>
          <th>Hotel</th>
          <th>City</th>
          <th>State</th>
          <th>Requirement Mentioned</th>
          <th>Search Time</th>
          <th>Call Back Time</th>
          <th>Call Back Agent</th>
          <th>Intent of Call</th>
          <th>Remarks if Others</th>
          <th>Booking ID</th>
          <th>Check-in Date</th>
          <th>Check-out Date</th>
          <th>No. of Rooms</th>
          <th>Booking Created</th>
          <th>Reason of Non-Booking</th>
          <th>Prepay Pitched</th>
          <th>Prepay Collected</th>
          <th>Reason of Non-Prepay</th>
          <th>Agent Remarks</th>
        </tr>
      </thead>
      <tbody id="data-table">
        <!-- Data will be dynamically populated here -->
      </tbody>
    </table>
    <button type="button" id="save-button">Save</button>
  </form>

  <script>
    const jsonFilePath = 'Data.json'; // Path to the JSON file
    const writeFilePath = 'Write-Record.json'; // Path to the write file
    const tableBody = document.getElementById('data-table');

    // Fetch JSON data and populate table
    fetch(jsonFilePath)
      .then(response => response.json())
      .then(data => {
        const mobileGroups = groupByMobileNumber(data);

        mobileGroups.forEach(records => {
          records.forEach((record, index) => {
            const row = document.createElement('tr');

            row.innerHTML = `
              <td>${record.Area}</td>
              <td>${record.Hotel}</td>
              <td>${record.City}</td>
              <td>${record.State}</td>
              <td>${record["Requirement Mentioned"]}</td>
              <td>${formatDate(record["Search Time"])}</td>
              <td>${getISTCurrentTime()}</td>
              <td>LoggedUser</td>
              <td>
                <select name="intent">
                  <option value="Sales">Sales</option>
                  <option value="Service">Service</option>
                  <option value="Enquiry">Enquiry</option>
                  <option value="Others">Others</option>
                </select>
              </td>
              <td><input type="text" name="remarks" ${record["Intent of call "] !== "Others" ? "readonly" : ""}></td>
              <td><input type="text" name="booking_id"></td>
              <td><input type="date" name="check_in_date"></td>
              <td><input type="date" name="check_out_date"></td>
              <td><input type="number" name="rooms"></td>
              <td>
                <select name="booking_created">
                  <option value="Yes">Yes</option>
                  <option value="No">No</option>
                </select>
              </td>
              <td><input type="text" name="reason_non_booking"></td>
              <td>
                <select name="prepay_pitched">
                  <option value="Yes">Yes</option>
                  <option value="No">No</option>
                </select>
              </td>
              <td>
                <select name="prepay_collected">
                  <option value="Yes">Yes</option>
                  <option value="No">No</option>
                </select>
              </td>
              <td><input type="text" name="reason_non_prepay"></td>
              <td><textarea name="agent_remarks"></textarea></td>
            `;

            tableBody.appendChild(row);
          });
        });
      })
      .catch(error => console.error('Error fetching JSON data:', error));

    // Group records by mobile number
    function groupByMobileNumber(data) {
      const grouped = {};
      data.forEach(item => {
        if (!grouped[item.Mobile_Number]) {
          grouped[item.Mobile_Number] = [];
        }
        grouped[item.Mobile_Number].push(item);
      });
      return Object.values(grouped);
    }

    // Format Excel datetime to dd/mm/yyyy hh:mm:ss
    function formatDate(excelDate) {
      const date = new Date((excelDate - 25569) * 86400 * 1000);
      return date.toLocaleString('en-IN');
    }

    // Get current time in IST
    function getISTCurrentTime() {
      const now = new Date();
      const offset = 5.5 * 60 * 60 * 1000; // IST offset
      const istTime = new Date(now.getTime() + offset);
      return istTime.toLocaleString('en-IN');
    }
  </script>
</body>
</html>
